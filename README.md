# Medical Image Analysis

A medical image classification platform with deep learning models and Grad-CAM visualization support. Currently supports brain tumor MRI classification with plans to expand to other medical imaging tasks.

## Overview

This project provides:
- REST API for medical image classification
- Grad-CAM visualizations for model interpretability
- Extensible architecture for adding new classification models
- Web frontend for uploading and analyzing images

## Current Models

| Model | Task | Classes | Test Accuracy |
|-------|------|---------|---------------|
| `brain_tumor` | MRI Classification | glioma, meningioma, pituitary, notumor | 99% |

## Project Structure

```
medical-image-analysis/
├── api/
│   ├── app/
│   │   ├── main.py             # FastAPI application
│   │   ├── models/
│   │   │   ├── base.py         # Base classifier interface
│   │   │   └── brain_tumor.py  # Brain tumor classifier
│   │   └── utils/
│   │       └── gradcam.py      # Grad-CAM visualization
│   ├── weights/                # Model weights (not tracked in git)
│   ├── Dockerfile
│   ├── fly.toml
│   └── requirements.txt
├── frontend/                   # React frontend (coming soon)
└── notebooks/
    └── brain_tumor_classifier.ipynb
```

## Deployment

### API (Fly.io)

```bash
cd api
fly auth login
fly launch --name your-api-name
fly deploy
```

### Frontend (Vercel)

```bash
cd frontend
vercel
```

## Training

The training notebook is provided in `notebooks/brain_tumor_classifier.ipynb`:

1. Open in Google Colab
2. Enable GPU runtime (Runtime > Change runtime type > GPU)
3. Run all cells
4. Download `brain_tumor_deployment.zip`
5. Extract weights to `api/weights/`

Dataset: [Brain Tumor MRI Dataset](https://www.kaggle.com/datasets/masoudnickparvar/brain-tumor-mri-dataset)

## Adding New Models

1. Create a new classifier in `api/app/models/` extending `BaseClassifier`
2. Register the model in `api/app/main.py`
3. Add weights to `api/weights/` and redeploy

## Roadmap

### In Progress
- [ ] Pneumonia detection from chest X-rays
- [ ] Frontend web application

### Planned
- [ ] Additional tumor classification models
- [ ] Batch prediction endpoint
- [ ] Model versioning
- [ ] Authentication and rate limiting

## Technical Details

### Model Architecture

EfficientNet-V2-S pretrained on ImageNet with custom classification head:
- Input: 224x224 RGB images
- Backbone: EfficientNet-V2-S (frozen early layers)
- Classifier: Dropout(0.3) → Linear(1280, 512) → ReLU → Dropout(0.15) → Linear(512, 4)

### Grad-CAM

Visualizations generated by backpropagating target class scores and computing weighted activation maps from the last convolutional layer.

## API Reference

### Health Check

```
GET /health
```

### List Models

```
GET /models
```

### Classification

```
POST /predict/{model_name}
Content-Type: multipart/form-data
file: <image_file>
```

Response:
```json
{
  "model": "brain_tumor",
  "prediction": "glioma",
  "confidence": 0.9847,
  "probabilities": {
    "glioma": 0.9847,
    "meningioma": 0.0089,
    "notumor": 0.0041,
    "pituitary": 0.0023
  }
}
```

### Classification with Grad-CAM

```
POST /predict/{model_name}/gradcam?output_type=all
POST /predict/{model_name}/gradcam/image?image_type=comparison
```

## Local Development

### API

```bash
cd api
python -m venv venv
source venv/bin/activate
pip install fastapi "uvicorn[standard]" python-multipart pillow opencv-python-headless numpy
pip install torch torchvision --index-url https://download.pytorch.org/whl/cpu

# Add weights to weights/ (brain_tumor_model.pth, model_config.json)

python -m uvicorn app.main:app --reload --port 8000
```

API docs: http://localhost:8000/docs

### Frontend

```bash
cd frontend
npm install
npm run dev
```

## License

MIT

## Acknowledgments

- [Brain Tumor MRI Dataset](https://www.kaggle.com/datasets/masoudnickparvar/brain-tumor-mri-dataset) by Masoud Nickparvar
- [EfficientNet-V2](https://arxiv.org/abs/2104.00298) by Google Research
- [Grad-CAM](https://arxiv.org/abs/1610.02391) by Selvaraju et al.